package tsunami.features.modules.misc;

import java.awt.Color;
import meteordevelopment.orbit.EventHandler;
import net.minecraft.class_1802;
import net.minecraft.class_238;
import net.minecraft.class_243;
import net.minecraft.class_2708;
import net.minecraft.class_2828;
import net.minecraft.class_4587;
import net.minecraft.class_2828.class_2829;
import net.minecraft.class_2828.class_2830;
import net.minecraft.class_2828.class_2831;
import net.minecraft.class_2828.class_5911;
import org.jetbrains.annotations.NotNull;
import tsunami.events.impl.EventSync;
import tsunami.events.impl.PacketEvent;
import tsunami.features.modules.Module;
import tsunami.setting.Setting;
import tsunami.setting.impl.Bind;
import tsunami.setting.impl.ColorSetting;
import tsunami.utility.render.Render3DEngine;

public class ChorusExploit extends Module {
   private final Setting<Bind> confirm = new Setting("Confirm", new Bind(340, false, false));
   private final Setting<ColorSetting> color = new Setting("Color", new ColorSetting(new Color(16777215)));
   class_243 choruspos = null;
   class_2708 chorusPacket = null;
   boolean isEatingChorus = false;
   int chorusTicks = 0;

   public ChorusExploit() {
      super("ChorusExploit", Module.Category.NONE);
   }

   public void onDisable() {
      if (this.chorusPacket != null) {
         this.chorusPacket.method_11740(mc.field_1724.field_3944);
         this.reset();
      }

   }

   private void reset() {
      this.chorusPacket = null;
      this.choruspos = null;
   }

   public void onRender3D(class_4587 stack) {
      if (this.choruspos != null) {
         Render3DEngine.drawBoxOutline(new class_238(this.choruspos.method_1031(-0.27D, 0.0D, -0.27D), this.choruspos.method_1031(0.27D, 1.8D, 0.27D)), ((ColorSetting)this.color.getValue()).getColorObject(), 2.0F);
      }

   }

   @EventHandler
   public void onUpdate(EventSync e) {
      if (mc.field_1724.method_6030() != null) {
         if (mc.field_1724.method_6030().method_7909() == class_1802.field_8233) {
            this.isEatingChorus = true;
         } else if (this.isEatingChorus) {
            ++this.chorusTicks;
            if (this.chorusTicks > 5) {
               this.isEatingChorus = false;
               this.chorusTicks = 0;
            }
         }

         if (this.isKeyPressed(this.confirm) && this.chorusPacket != null) {
            this.chorusPacket.method_11740(mc.method_1562());
            this.reset();
         }

      }
   }

   @EventHandler
   public void onPacketReceive(@NotNull PacketEvent.Receive e) {
      if (e.getPacket() instanceof class_2708 && (this.isEatingChorus || this.choruspos != null)) {
         this.chorusPacket = (class_2708)e.getPacket();
         this.choruspos = new class_243(this.chorusPacket.method_11734(), this.chorusPacket.method_11735(), this.chorusPacket.method_11738());
         e.cancel();
      }

   }

   @EventHandler
   public void onPacketSend(PacketEvent.Send e) {
      if (this.chorusPacket != null && (e.getPacket() instanceof class_2828 || e.getPacket() instanceof class_2830 || e.getPacket() instanceof class_2831 || e.getPacket() instanceof class_5911 || e.getPacket() instanceof class_2829)) {
         e.cancel();
      }

   }
}
